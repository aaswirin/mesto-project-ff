(()=>{"use strict";var e={idTemplate:"#card-template",classPlacesList:".places__list",classPlacesItem:".places__item",classCardImage:".card__image",classCardTitle:".card__title",classCardDeleteButton:".card__delete-button",classListItem:"li.places__item",classWindowPopup:".popup__content",classWindowOpen:".popup_is-opened",classWindowOpenNotDot:"popup_is-opened",classWindowAnimatedNotDot:"popup_is-animated",classElementClose:".popup__close",classForm:".popup__form",classInput:".popup__input",classSubmitButton:".popup__button",classSubmitLabel:".popup__button-label",classSpinner:".popup__spinner",classSpinnerVisible:"popup__spinner-visible",keysClose:["Escape"],classButtonEditAvatar:".profile__image",classWindowEditAvatar:".popup_edit-avatar",bindAvatar:[{name:"link",nameForm:"link-avatar"}],classButtonEditProfile:".profile__edit-button",classWindowEditProfile:".popup_type_edit",bindProfile:[{classPage:".profile__title",nameAPI:"name",nameForm:"name",typeElement:"text"},{classPage:".profile__description",nameAPI:"about",nameForm:"description",typeElement:"text"},{classPage:".profile__image",nameAPI:"avatar",nameForm:"",typeElement:"image"}],classButtonAddCard:".profile__add-button",classWindowAddCard:".popup_type_new-card",bindCard:[{name:"name",nameForm:"place-name"},{name:"link",nameForm:"link"}],classWindowViewImage:".popup_type_image",classViewImage:".popup__image",classViewCaption:".popup__caption",classWindowMessage:".popup_message",classCaptionMessage:".popup__title",classTextMessage:".popup__text",classMarkerCall:".popup__marker-call",classLikeButton:".card__like-button",classLikeYesNotDot:"card__like-button_is-active",classLikesCount:".card__likes-count",classLikesTooltip:".card__tooltip",classItemTooltip:"card__tooltip-item",classTitleTooltip:"card__tooltip-title",classImageTooltip:"card__tooltip-image",classTextTooltip:"card__tooltip-text",countLikeInTooltip:5,classErrorValidation:"popup__input-error",classValidationContainer:"popup__input-error-container-active",classButtonInActive:"popup__button-inactive",apiIdUser:"",apiURL:"https://nomoreparties.co/v1/",apiIdGroup:"wff-cohort-35",apiToken:"1e636933-64cf-4fb7-82cc-a4047b92f087",methodProfile:"users/me",methodCard:"cards",methodLike:"cards/likes",methodAvatar:"users/me/avatar"};function t(e,t,n){var a=t.likes.length;e.querySelector(n.classLikesCount).textContent=a.toString();for(var o=e.querySelector(n.classLikesTooltip),s=o.lastElementChild;s;)o.removeChild(s),s=o.lastElementChild;var l=document.createElement("li");if(l.classList.add(n.classTitleTooltip),0===a)l.textContent="Увы, лайков нет...";else{l.textContent="Лайки этого места:";var i=0,r=0;if(t.likes.forEach((function(t){if(t._id===n.apiIdUser&&e.querySelector(n.classLikeButton).classList.add(n.classLikeYesNotDot),i<=n.countLikeInTooltip+1){var a=document.createElement("li");a.classList.add(n.classItemTooltip);var s=document.createElement("img");s.classList.add(n.classImageTooltip),s.setAttribute("src",t.avatar),s.setAttribute("alt","Установил лайк: "+t.name),a.append(s);var l=document.createElement("span");l.classList.add(n.classTextTooltip),l.textContent=t.name,a.append(l),o.append(a),i++}else r++})),0!==r){var c=document.createElement("li");c.classList.add(n.classTitleTooltip),c.textContent="...и ещё ".concat(r)}}o.prepend(l)}function n(e,n,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=o.cardTemplate,l=o.placesContainer,i=o.onOpenPreview,r={onDeleteCard:o.onDeleteCard,onOpenPreview:i,onLikeCard:o.onLikeCard};e.forEach((function(e){var o=function(e,n,a,o){var s=n.querySelector(a.classPlacesItem).cloneNode(!0),l=s.querySelector(a.classCardImage);l.setAttribute("src",e.link),l.setAttribute("alt","Место на картинке: "+e.name),l.addEventListener("click",(function(e){return o.onOpenPreview(e)})),s.querySelector(a.classCardTitle).textContent=e.name;var i=s.querySelector(a.classCardDeleteButton);return e.owner._id===a.apiIdUser?i.addEventListener("click",(function(){return o.onDeleteCard(s,e._id)})):i.remove(),s.querySelector(a.classLikeButton).addEventListener("click",(function(t){return o.onLikeCard(t,e._id,a)})),t(s,e,a),s}(e,s,n,r);a?l.prepend(o):l.append(o)}))}function a(e,t,n){e.classList.add(t.classWindowAnimatedNotDot),e.querySelector(t.classElementClose).addEventListener("click",(function(){return n.close(e,n.close)})),e.addEventListener("mouseup",(function(t){return n.closeUp(t,e,n.closeUp)}))}function o(e,t,n){e.classList.add(t.classWindowOpenNotDot),document.addEventListener("keydown",n)}function s(e,t,n){e.classList.remove(t.classWindowOpenNotDot),document.removeEventListener("keydown",n)}function l(e,t,n){var a=Array.from(e.querySelectorAll(n.classInput));a.forEach((function(e){i(e,n)})),r(a,t,n),t.querySelector(n.classSubmitLabel).textContent="Сохранить",t.querySelector(n.classSpinner).classList.remove(n.classSpinnerVisible)}function i(e,t){var n=document.querySelector(".popup__input-error-".concat(e.id));e.classList.remove(t.classErrorValidation),n.textContent="",n.classList.remove(t.classValidationContainer)}function r(e,t,n){c(t,function(e){return e.some((function(e){return!e.validity.valid}))}(e),n)}function c(e,t,n){e.disabled=t,t?e.classList.add(n.classButtonInActive):e.classList.remove(n.classButtonInActive)}function u(e,t,n,a){Promise.all(e).then((function(e){e.forEach((function(o,s){o.json().then((function(o){if(!e[s].ok){var l="Ошибка ".concat(e[s].status);return void 0!==o.message&&(l+=": ".concat(o.message)),Promise.reject(l)}t[s](!0,o,n,a)})).catch((function(e){t[0](!1,{error:e},n,a)}))}))})).catch((function(e){t[0](!1,{error:e},n,a)}))}function d(e,t){var n="".concat(t.apiURL).concat(t.apiIdGroup,"/").concat(e.nameMethod),a={method:e.method,headers:{authorization:t.apiToken}};return null!==e.id&&(n+="/".concat(e.id)),null!==e.body&&(a.headers["Content-Type"]="application/json",a.body=JSON.stringify(e.body)),fetch(n,a)}function m(e,t,n){u([d({nameMethod:n.methodCard,method:"DELETE",body:null,id:t.id},n)],[e],t,n)}var p=document.querySelector(e.idTemplate).content,f=document.querySelector(e.classPlacesList),v=document.querySelector(e.classWindowEditAvatar),_=v.querySelector(e.classForm),b=_.querySelector(e.classSubmitButton),y=document.querySelector(e.classWindowEditProfile),S=y.querySelector(e.classForm),C=S.querySelector(e.classSubmitButton),L=document.querySelector(e.classWindowAddCard),k=L.querySelector(e.classForm),E=k.querySelector(e.classSubmitButton),h=document.querySelector(e.classWindowViewImage),g=h.querySelector(e.classViewImage),q=document.querySelector(e.classWindowMessage),P=q.querySelector(e.classCaptionMessage),A=q.querySelector(e.classTextMessage),T=q.querySelector(e.classSubmitButton);function I(t){var n=t.querySelector(e.classForm);return null===n?"":n.getAttribute("name")}function w(e){var t=I(e);""!==t&&document.forms[t].reset()}function x(e,t,n){n.forEach((function(t){var n=document.querySelector(t.classPage);if(null!==n){var a=e[t.nameAPI];"text"===t.typeElement?n.textContent=a:"image"===t.typeElement&&n.setAttribute("style","background-image: url(".concat(a,");"))}}))}function M(t,n){s(t,e,n),t===q&&T.classList.remove(e.classMarkerCall),w(t)}function B(t){if(function(e,t){return-1!==t.keysClose.findIndex((function(t){return t===e.key}))}(t,e)){var n=document.querySelector(e.classWindowOpen);null!==n&&M(n,B)}}document.querySelector(e.classButtonEditAvatar).addEventListener("click",(function(){l(_,b,e),c(b,!0,e),o(v,e,B)})),document.querySelector(e.classButtonEditProfile).addEventListener("click",(function(){var t,n,a;t=y,n=e.bindProfile,""!==(a=I(t))&&n.forEach((function(e){if(""!==e.nameForm){var t=document.querySelector(e.classPage);null!==t&&(document.forms[a].elements[e.nameForm].value=t.textContent)}})),l(y,C,e),c(C,!1,e),o(y,e,B)})),document.querySelector(e.classButtonAddCard).addEventListener("click",(function(){l(k,E,e),c(E,!0,e),o(L,e,B)}));var D={functionCall:null,callback:null,data:{}};function V(t,n,a){P.textContent=t,A.textContent=n,T.textContent=a,o(q,e,B)}function W(e,t,n,a){e?(a.apiIdUser=t._id,x(t,0,a.bindProfile)):V("Ошибка при загрузке",t.error,"Понятно")}function F(t,a){t?function(t,a){a&&""!==I(L)&&n(t,e,!0,Y)}([a],t):V("Ошибка при загрузке",a.error,"Понятно")}function N(e,t,n){var a;e?null!==(a=n.elementPlace)&&a.remove():V("Ошибка при загрузке",t.error,"Понятно")}function O(n,a,o){n?(o.elementLike.parentElement.querySelector(e.classLikesCount).textContent=a.likes.length.toString(),function(e,t){e.classList.toggle(t.classLikeYesNotDot)}(o.elementLike,e),t(o.elementCard,a,e)):V("Ошибка при загрузке",a.error,"Понятно")}function U(t,n){t?x(n,0,e.bindProfile):V("Ошибка при загрузке",n.error,"Понятно")}var G={close:M,closeUp:function(t,n,a){(function(e,t){return null===e.target.closest(t.classWindowPopup)})(t,e)&&M(n,a)}},Y={cardTemplate:p,placesContainer:f,onOpenPreview:function(t){!function(t,n){g.setAttribute("src",n.getAttribute("src")),g.setAttribute("alt",n.getAttribute("alt"));var a=n.closest(e.classListItem);null!==a&&(t.querySelector(e.classViewCaption).textContent=a.querySelector(e.classCardTitle).textContent)}(h,t.target),o(h,e,B)},onDeleteCard:function(t,n){D.functionCall=m,D.callback=N,D.data.id=n,D.data.elementPlace=t,T.classList.add(e.classMarkerCall),V("Вы уверены?","","Да")},onLikeCard:function(e,t,n){if(null!==e.target){var a={id:t,elementCard:e.target.closest(n.classPlacesItem),elementLike:e.target};e.target.classList.contains(n.classLikeYesNotDot)?function(e,t,n){u([d({nameMethod:n.methodLike,method:"DELETE",body:null,id:t.id},n)],[e],t,n)}(O,a,n):function(e,t,n){u([d({nameMethod:n.methodLike,method:"PUT",body:null,id:t.id},n)],[e],t,n)}(O,a,n)}}};!function(e,t,a){u([d({nameMethod:a.methodProfile,method:"GET",body:null,id:null},a),d({nameMethod:a.methodCard,method:"GET",body:null,id:null},a)],[e,function(e,t,a,o){e?n(t,o,!1,Y):V("Ошибка при загрузке",t.error,"Понятно")}],null,a)}(W,0,e),S.addEventListener("submit",(function(t){t.preventDefault();var n=I(y);if(""!==n){var a={};e.bindProfile.forEach((function(e){""!==e.nameAPI&&""!==e.nameForm&&(a[e.nameAPI]=document.forms[n].elements[e.nameForm].value)})),a.buttonSubmit=C,function(e,t,n){var a=[d({nameMethod:n.methodProfile,method:"PATCH",body:{name:t.name,about:t.about},id:null},n)],o=[e];t.buttonSubmit.querySelector(n.classSubmitLabel).textContent="Сохранить...",t.buttonSubmit.querySelector(n.classSpinner).classList.add(n.classSpinnerVisible),u(a,o,null,n)}(W,a,e),s(y,e,B),w(y)}})),a(y,e,G),k.addEventListener("submit",(function(t){t.preventDefault();var n=I(L);if(""!==n){var a={};e.bindCard.forEach((function(e){a[e.name]=document.forms[n].elements[e.nameForm].value})),a.buttonSubmit=E,function(e,t,n){var a=[d({nameMethod:n.methodCard,method:"POST",body:{name:t.name,link:t.link},id:null},n)],o=[e];t.buttonSubmit.querySelector(n.classSubmitLabel).textContent="Сохранить...",t.buttonSubmit.querySelector(n.classSpinner).classList.add(n.classSpinnerVisible),u(a,o,null,n)}(F,a,e),s(L,e,B),w(L)}})),a(L,e,G),a(h,e,G),_.addEventListener("submit",(function(t){t.preventDefault();var n=I(v);if(""!==n){var a={};e.bindAvatar.forEach((function(e){a[e.name]=document.forms[n].elements[e.nameForm].value})),a.buttonSubmit=b,function(e,t,n){var a=[d({nameMethod:n.methodAvatar,method:"PATCH",body:{avatar:t.link},id:null},n)],o=[e];t.buttonSubmit.querySelector(n.classSubmitLabel).textContent="Сохранить...",t.buttonSubmit.querySelector(n.classSpinner).classList.add(n.classSpinnerVisible),u(a,o,null,n)}(U,a,e),s(v,e,B),w(v)}})),a(v,e,G),T.addEventListener("click",(function(){T.classList.contains(e.classMarkerCall)&&D.functionCall(D.callback,D.data,e),M(q,B)})),a(q,e,G),function(e){Array.from(document.querySelectorAll(e.classForm)).forEach((function(t){var n=t.querySelector(e.classSubmitButton);!function(e,t,n){var a=Array.from(e.querySelectorAll(n.classInput));a.forEach((function(e){e.addEventListener("input",(function(){!function(e,t,n,a,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?i(t,o):function(e,t,n){var a=document.querySelector(".popup__input-error-".concat(e.id));e.classList.add(n.classErrorValidation),a.textContent=t,a.classList.add(n.classValidationContainer)}(t,t.validationMessage,o),r(n,a,o)}(0,e,a,t,n)}))}))}(t,n,e)}))}(e)})();
//# sourceMappingURL=main.js.map